{% extends "layout.html" %}

{% block title %}
Categories
{% endblock %}

{% block main %}
<div>
    <h1 style="display: inline">Categories</h1>
    <!-- Category counter (STRETCH GOAL) -->
</div>
<div>
    <table id="Categories_table">
        <thead>
            <tr>
                {% for column_name in column_names %}
                    {% if column_name.lower() == "id" %}
                        <th class="hidden_col">{{ column_name }}</th>
                    {% elif column_name == "DELETE_BUTTONS" %}
                        <th hidden>{{ column_name }}</th>
                    {% else %}
                        <th>{{ column_name }}</th>
                    {% endif %}
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            <!-- Table rows get generated by updateTable function -->
        </tbody>
    </table>
</div>

<script>
    // Update the table when the window loads
    $(document).ready(function() {
        updateTable();
    });

    function updateTable() {
        // Get a list of the table headers
        var headers = $("thead th").map(function() {
            return $(this).text();
        }).get();

        $.ajax({
            url: "/get_catTable_data",
            type: "GET",
            dataType: "json",
            success: function(response) {
                // Clear the existing table body
                $("tbody").empty();

                // Iterate over each row
                $.each(response["rows"], function(d_idx, row) {
                    // Create empty row
                    var tr = $("<tr>").attr("data-row", d_idx + 1);

                    // Iterate over each header and fill row cells
                    $.each(headers, function(h_idx, header) {
                        if (header.toLowerCase() == "id") {
                            // Create a hidden cell for the id
                            $("<td>").addClass("hidden_col").text(row[header]).appendTo(tr);
                        } else if (header.toLowerCase() == "category") {
                            // Create a category element
                            var cat_input = $("<input>").addClass("cat-ren");
                            cat_input.val(row["category"])
                            $("<td>").append(cat_input).appendTo(tr);
                        }
                    })

                    // Append row to table
                    $("tbody").append(tr);
                })
            }
        })
    }
</script>

{% endblock %}
